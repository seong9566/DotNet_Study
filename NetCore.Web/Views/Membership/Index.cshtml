@using System.Security.Claims
@{
    ViewData["Title"] = "멤버쉽";
    Layout = "_Layout";
}

<h2>@ViewData["Title"]</h2>

@if (TempData["Message"] is string message && !string.IsNullOrWhiteSpace(message))
{
    <div class="alert alert-info" role="alert">@message</div>
}

@if (User?.Identity?.IsAuthenticated == true)
{
    var userData = User.FindFirst(ClaimTypes.UserData)?.Value;
    string roleName = "", rolePriority = "", userName = "", email = "";
    if (!string.IsNullOrWhiteSpace(userData))
    {
        var parts = userData.Split('|');
        if (parts.Length >= 4)
        {
            roleName = parts[0];      // 권한 이름
            rolePriority = parts[1];  // 권한 우선순위
            userName = parts[2];      // 사용자 이름
            email = parts[3];         // 사용자 이메일
        }
    }

    <div class="card mt-3">
        <div class="card-header">로그인 정보</div>
        <div class="card-body">
            <dl class="row mb-0">
                <dt class="col-sm-3">이름</dt>
                <dd class="col-sm-9">@userName</dd>

                <dt class="col-sm-3">아이디</dt>
                <dd class="col-sm-9">@User.FindFirstValue(ClaimTypes.NameIdentifier)</dd>

                <dt class="col-sm-3">권한</dt>
                <dd class="col-sm-9">@($"{roleName} / Priority: {rolePriority}")</dd>

                <dt class="col-sm-3">이메일</dt>
                <dd class="col-sm-9">@email</dd>
            </dl>
        </div>
    </div>
}
else
{
    <p class="mt-3">
        <a class="btn btn-primary" asp-controller="Membership" asp-action="Login">로그인 테스트</a>
    </p>
}
